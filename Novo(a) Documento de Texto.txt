#include <stdio.h>
#include <locale.h>

#define TAM 10   // número máximo de cadastros

// Definição da struct

struct REG_PESSOA {
    int codigo;
    int excluido;         // 1 = ativo, 0 = excluído
    char nome[50];
};

void limpar() {
    char c;
    while ((c = getchar()) != '\n' && c != EOF);
}

void inicializarLista(struct REG_PESSOA lista[]) {
    int i;
    for (i = 0; i < TAM; i++) {
        lista[i].excluido = 0;  // 0 = inativo/excluído
    }
}

// Procura uma pessoa pelo código

int procurarCodigo(struct REG_PESSOA lista[], int codigo) {
    int i;
    for (i = 0; i < TAM; i++) {

        // Verifica se o registro está ativo e se o código bate

        if (lista[i].excluido == 1 && lista[i].codigo == codigo) {
            return i;
        }
    }
    return -1; // não encontrou
}

// Procura o primeiro espaço vazio (registro inativo)

int procurarEspaco(struct REG_PESSOA lista[]) {
    int i;
    for (i = 0; i < TAM; i++) {
        if (lista[i].excluido == 0) {
            return i;
        }
    }
    return -1;
}


// ---------------- FUNÇÕES PRINCIPAIS ---------------- \\


// Cadastra uma nova pessoa

void cadastro(struct REG_PESSOA lista[]) {
    int pos = procurarEspaco(lista);

    if (pos == -1) {
        printf("Limite de registros atingido! Exclua alguém primeiro.\n");
        return;
    }

    int codigo;
    printf("Digite o código: ");
    scanf("%d", &codigo);
    limpar();

    if (procurarCodigo(lista, codigo) != -1) {
        printf("Código já cadastrado!\n");
        return;
    }

    lista[pos].codigo = codigo;

    printf("Digite o nome: ");
    scanf("%49s", lista[pos].nome);
    limpar();

    lista[pos].excluido = 1; // marca como ativo
    printf("A pessoa foi cadastrada com sucesso!\n");
}

// Exclui uma pessoa pelo código

void excluirPessoa(struct REG_PESSOA lista[]) {

    int codigo;
    printf("Digite o código para excluir: ");
    scanf("%d", &codigo);
    limpar();

    int pos = procurarCodigo(lista, codigo);

    if (pos == -1) {
        printf("Registro não encontrado!\n");
        return;
    }

    printf("Nome: %s\n", lista[pos].nome);
    printf("Confirma exclusão? (S/N): ");
    char resposta = getchar();
    limpar();

    if (resposta == 'S' || resposta == 's') {
        lista[pos].excluido = 0; // marca como inativo
        printf("O registro foi excluído!\n");
    } else {
        printf("Exclusão cancelada.\n");
    }
}

// Mostra todos os registros ativos

void relatorio(struct REG_PESSOA lista[]) {
    printf("\n--- RELATÓRIO DE PESSOAS ---\n");
    printf("Registro | Código | Nome\n");
    printf("----------------------------\n");

    int i;

    for (i = 0; i < TAM; i++) {
        if (lista[i].excluido == 1) {
            printf("%8d | %6d | %s\n", i + 1, lista[i].codigo, lista[i].nome);
        }
    }
}

// Mostra o menu principal

void menu() {
    printf("\n===== MENU =====\n");
    printf("1 - Cadastrar pessoa\n");
    printf("2 - Excluir pessoa\n");
    printf("3 - Relatório\n");
    printf("4 - Sair\n");
    printf("Escolha: ");
}


// ---------------- FUNÇÃO PRINCIPAL ---------------- \\

int main() {
    setlocale(LC_ALL, "Portuguese_Brazil");

    struct REG_PESSOA lista[TAM];
    inicializarLista(lista);

    int opcao;

    do {
        menu();
        scanf("%d", &opcao);
        limpar();

        switch (opcao) {
            case 1:
                cadastro(lista);
                break;
            case 2:
                excluirPessoa(lista);
                break;
            case 3:
                relatorio(lista);
                break;
            case 4:
                printf("Encerrando programa...\n");
                break;
            default:
                printf("Opção inválida! Tente novamente.\n");
        }

    } while (opcao != 4);

    return 0;
}